webpackJsonp([2],{"6dqP":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("Dd8w"),a=s.n(i),n=s("NYxO"),o={name:"BasicQuotaType",mixins:[],components:{},data:function(){return{tableWidth:0,showTree:!0,typeTreeProp:{label:"name",children:"zones",isLeaf:"leaf"},formLabelWidth:"120px",aLevel:["","一级","二级","三级","四级"],sParent:"",sLevel:"",typeForm:{pid:"",name:"",code:""},addTypeVisible:!1,addTypeTitle:"",page:1,pageSize:20,categoryTotal:0}},beforeRouteEnter:function(e,t,s){s()},created:function(){},mounted:function(){this.setWidth()},computed:{},methods:a()({},Object(n.b)(["getCategoryListAction","addCategoryAction","updateCategoryAction","deleteCategoryAction"]),{setWidth:function(){for(var e=(window.innerWidth-40)/4,t=document.querySelectorAll(".custom-tree-node .-field"),s=0;s<t.length;s++)t[s].style.flexBasis=e+"px"},loadSubTypes:function(e,t){var s=this,i=this.$loading({}),a={};0===e.level?(a={pageNum:this.page,pageSize:this.pageSize},0===e.childNodes.length&&this.getCategoryListAction(a).then(function(e){i.close(),t(e.list),s.categoryTotal=e.count,setTimeout(function(){s.setWidth()},200)}).catch(function(e){i.close(),s.$message.error(e)})):(a={pid:e.data.id},this.getCategoryListAction(a).then(function(e){i.close(),t(e.list),setTimeout(function(){s.setWidth()},200)}).catch(function(e){i.close(),s.$message.error(e)}))},getQuotaTypeDatas:function(){this.updateChildren()},clickTypeTree:function(e,t,s){t.checked?this.$refs.typeTree.setChecked(e,!1,!1):this.$refs.typeTree.setChecked(e,!0,!1)},startAddType:function(){var e=this.$refs.typeTree.getCheckedNodes();if(e.length>1)this.$message.warning("请选择一个父节点!");else{if(0===e.length)this.sParent="无",this.sLevel="一级",this.typeForm={name:"",code:""};else{var t=this.$refs.typeTree.getNode(e[0].id).level;this.sParent=e[0].name,this.sLevel=this.aLevel[t+1],this.typeForm={pid:e[0].id,name:"",code:""}}this.addTypeTitle="添加节点",this.addTypeVisible=!0}},startEditType:function(){var e=this.$refs.typeTree.getCheckedNodes();if(1===e.length){var t=this.$refs.typeTree.getNode(e[0].id).level;this.sParent=t>1?this.$refs.typeTree.getNode(e[0].id).parent.data.name:"无",this.sLevel=this.aLevel[t],this.typeForm={id:e[0].id,name:e[0].name,code:e[0].code},this.addTypeTitle="修改节点",this.addTypeVisible=!0}else this.$message.warning("请选择一个节点!")},checkForm:function(){return""===this.typeForm.name.trim()?(this.$message.warning("请填写节点名称!"),!1):""!==(this.typeForm.code+"").trim()||(this.$message.warning("请填写节点代码!"),!1)},submitTypeForm:function(){this.checkForm()&&(this.typeForm.id?this.editType():this.addType())},updateChildren:function(e){var t=this,s={};s=e?{pid:e.id}:{pageNum:this.page,pageSize:this.pageSize},e?this.getCategoryListAction(s).then(function(s){t.$refs.typeTree.updateKeyChildren(e.id,s.list),setTimeout(function(){t.setWidth()},200)}).catch(function(e){t.$message.error(e)}):(this.showTree=!1,setTimeout(function(){t.showTree=!0},200))},addType:function(){var e=this;this.addCategoryAction(this.typeForm).then(function(t){e.$message.success("新增成功！"),e.addTypeVisible=!1;var s=e.$refs.typeTree.getCheckedNodes();0===s.length?e.updateChildren():e.updateChildren(s[0])}).catch(function(t){e.$message.error(t)})},editType:function(){var e=this;this.updateCategoryAction(this.typeForm).then(function(t){e.$message.success("修改成功！"),e.addTypeVisible=!1;var s=e.$refs.typeTree.getCheckedNodes();1===s[0].classify?e.updateChildren():e.updateChildren(e.$refs.typeTree.getNode(s[0].id).parent.data)}).catch(function(t){e.$message.error(t)})},startDeleteType:function(){var e=this,t=this.$refs.typeTree.getCheckedKeys();0!==t.length?t.length>1?this.$message.warning("请选择一个节点!"):this.$confirm("确认删除选中节点及其子节点？","提示",{confirmButtonText:"确定",showCancelButton:!1,type:"warning"}).then(function(){e.deleteType()}).catch(function(e){console.log(e)}):this.$message.warning("请选择要删除的节点!")},deleteType:function(){var e=this,t=this.$refs.typeTree.getCheckedKeys();this.deleteCategoryAction({id:t[0]}).then(function(t){e.$message.success("删除成功！");var s=e.$refs.typeTree.getCheckedNodes();1===s[0].classify?e.updateChildren():e.updateChildren(e.$refs.typeTree.getNode(s[0].id).parent.data)}).catch(function(t){e.$message.error(t)})}}),filters:{},watch:{},destroyed:function(){},beforeRouteLeave:function(e,t,s){s()}},l={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"handle-panel bg-gray-lightest p-10"},[s("el-button",{attrs:{size:"small",icon:"el-icon-circle-plus-outline",type:"primary"},on:{click:e.startAddType}},[e._v("新增下级节点")]),e._v(" "),s("el-button",{attrs:{size:"small",icon:"el-icon-edit"},on:{click:e.startEditType}},[e._v("修改")]),e._v(" "),s("el-button",{attrs:{size:"small",icon:"el-icon-delete"},on:{click:e.startDeleteType}},[e._v("删除")])],1),e._v(" "),s("div",{staticClass:"list-box"},[e._m(0),e._v(" "),e.showTree?s("div",[s("el-tree",{ref:"typeTree",attrs:{"node-key":"id",props:e.typeTreeProp,load:e.loadSubTypes,lazy:"","expand-on-click-node":!1,"check-strictly":"","empty-text":"暂无基础指标类型","show-checkbox":""},on:{"node-click":e.clickTypeTree},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,a=t.data;return s("span",{staticClass:"custom-tree-node"},[s("span",{staticClass:"-type"},[e._v(e._s(e.aLevel[i.level]+"节点"))]),e._v(" "),s("span",{staticClass:"-field"},[e._v(e._s(a.name))]),e._v(" "),s("span",{staticClass:"-field"},[e._v(e._s(a.code))]),e._v(" "),s("span",{staticClass:"-field"},[e._v(e._s(e.aLevel[i.level]))])])}}])})],1):e._e(),e._v(" "),e.categoryTotal>0?s("el-pagination",{staticClass:"text-right m-t-20",attrs:{layout:"prev, pager, next","current-page":e.page,"page-size":e.pageSize,total:e.categoryTotal},on:{"update:currentPage":function(t){e.page=t},"current-change":e.getQuotaTypeDatas}}):e._e()],1),e._v(" "),s("el-dialog",{attrs:{title:e.addTypeTitle,visible:e.addTypeVisible,width:"400px"},on:{"update:visible":function(t){e.addTypeVisible=t}}},[s("el-form",{attrs:{model:e.typeForm}},[s("el-form-item",{attrs:{label:"名称","label-width":e.formLabelWidth}},[s("el-input",{attrs:{placeholder:"请输入节点名称","auto-complete":"off"},model:{value:e.typeForm.name,callback:function(t){e.$set(e.typeForm,"name",t)},expression:"typeForm.name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"代码","label-width":e.formLabelWidth}},[s("el-input",{attrs:{placeholder:"请输入节点代码","auto-complete":"off"},model:{value:e.typeForm.code,callback:function(t){e.$set(e.typeForm,"code",t)},expression:"typeForm.code"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"级别","label-width":e.formLabelWidth}},[s("span",[e._v(e._s(e.sLevel))])]),e._v(" "),s("el-form-item",{attrs:{label:"父节点","label-width":e.formLabelWidth}},[s("span",[e._v(e._s(e.sParent))])])],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.addTypeVisible=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.submitTypeForm}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"el-table el-table--fit el-table--border el-table--enable-row-hover",staticStyle:{width:"100%"}},[t("div",{staticClass:"el-table__header-wrapper"},[t("table",{staticClass:"el-table__header",staticStyle:{width:"100%"},attrs:{cellpadding:"0",cellspacing:"0",border:"0"}},[t("thead",[t("tr",[t("th",{staticClass:"text-black"},[t("div",{staticClass:"cell"},[this._v("节点类型")])]),this._v(" "),t("th",{staticClass:"text-black"},[t("div",{staticClass:"cell"},[this._v("名称")])]),this._v(" "),t("th",{staticClass:"text-black"},[t("div",{staticClass:"cell"},[this._v("代码")])]),this._v(" "),t("th",{staticClass:"text-black"},[t("div",{staticClass:"cell"},[this._v("级别")])])])])])])])}]};var r=s("VU/8")(o,l,!1,function(e){s("rJC9")},"data-v-d85803b8",null);t.default=r.exports},rJC9:function(e,t){}});
//# sourceMappingURL=2.ef6d21b02fc44d2facaf.js.map